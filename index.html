<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Система логістики</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
</head>
<body>
  <main class="container my-4">
    <section id="home" class="tab-section active">
      <h2>Головна</h2>
      <img src="9195fd95-ba9b-4329-b9a9-f67e28136743.png" alt="логістика" class="img-fluid rounded shadow mb-3">
      <p>Ласкаво просимо до системи управління логістикою.</p>
      <ul>
        <li>Перегляд і додавання замовлень</li>
        <li>Контроль транспорту</li>
        <li>Керування працівниками</li>
        <li>Створення звітів</li>
        <li>Зворотній зв’язок</li>
      </ul>
    </section>

    <section id="reports" class="tab-section">
      <h2>Звіти</h2>
      <button id="generate-report-btn" class="btn btn-primary mb-2">Згенерувати звіт</button>
      <button id="download-csv-btn" class="btn btn-secondary d-none">CSV</button>
      <button id="download-pdf-btn" class="btn btn-secondary d-none">PDF</button>
      <button id="download-excel-btn" class="btn btn-secondary d-none">Excel</button>
      <div id="report-container" class="table-responsive mt-3"></div>
    </section>
  </main>

  <script>
  window.addEventListener('DOMContentLoaded', () => {
    let editingOrderId = null;
    let editingVehicleId = null;
    let editingEmployeeId = null;

    const el = {
      reportContainer: document.getElementById('report-container'),
      csvBtn: document.getElementById('download-csv-btn'),
      pdfBtn: document.getElementById('download-pdf-btn'),
      excelBtn: document.getElementById('download-excel-btn'),
      genReportBtn: document.getElementById('generate-report-btn')
    };

    function getStorage(key) {
      return JSON.parse(localStorage.getItem(key) || '[]');
    }

    function generateReport() {
      const employees = getStorage('employees');
      const orders = getStorage('orders');
      const transport = getStorage('transport');

      const report = employees.map(emp => {
        const orderCount = orders.filter(o => o.employeeId === emp.id).length;
        const transportCount = transport.filter(t => t.employeeId === emp.id).length;
        return { name: emp.name, orders: orderCount, transport: transportCount };
      });

      const tableHtml = `
        <table class="table table-bordered">
          <thead><tr><th>Працівник</th><th>Замовлень</th><th>Транспорт</th></tr></thead>
          <tbody>
            ${report.map(r => `<tr><td>${r.name}</td><td>${r.orders}</td><td>${r.transport}</td></tr>`).join('')}
          </tbody>
        </table>`;

      el.reportContainer.innerHTML = tableHtml;
      el.reportContainer.dataset.json = JSON.stringify(report);
      el.reportContainer.dataset.csv = [['Працівник','Замовлень','Транспорт'], ...report.map(r => [r.name, r.orders, r.transport])].map(row => row.join(',')).join('\n');

      [el.csvBtn, el.pdfBtn, el.excelBtn].forEach(btn => btn.classList.remove("d-none"));
    }

    el.genReportBtn?.addEventListener("click", generateReport);

    el.csvBtn?.addEventListener("click", () => {
      const csv = el.reportContainer.dataset.csv;
      const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "report.csv";
      a.click();
      URL.revokeObjectURL(a.href);
    });

    el.pdfBtn?.addEventListener("click", () => {
      const { jsPDF } = window.jspdf;
      const report = JSON.parse(el.reportContainer.dataset.json || "[]");
      const doc = new jsPDF();
      doc.setFontSize(14);
      doc.text("Звіт — Замовлення та транспорт по працівниках", 10, 10);
      let y = 20;
      report.forEach(r => {
        doc.text(`${r.name}: Замовлень — ${r.orders}, Транспорт — ${r.transport}`, 10, y);
        y += 10;
      });
      doc.save("report.pdf");
    });

    el.excelBtn?.addEventListener("click", () => {
      const data = JSON.parse(el.reportContainer.dataset.json || "[]");
      if (!data || data.length === 0) return alert("Немає даних для експорту.");
      const ws = XLSX.utils.json_to_sheet(data);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Звіт");
      XLSX.writeFile(wb, "report.xlsx");
    });
  });
  </script>
</body>
</html>
